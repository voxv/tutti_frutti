import{P as u}from"./Projectile-BlnVoN5p.js";import{ProjectileTower as m}from"./ProjectileTower-DxNJKAb7.js";import"./index-IaGGzpQf.js";class h extends u{constructor({position:e,towerPosition:a,speed:n,texture:o,sourceTower:r,arcDuration:s,flipArc:p=!1,arcRadius:c=120,verticalScale:l=.5,destroyOnReturn:i=!0,hitRadius:t=60}){super({position:e,direction:{x:0,y:0},speed:n,damage:0,texture:o}),this.towerPosition={...a},this.sourceTower=r,this.totalTime=0,this.arcRadius=c,this.arcDuration=s||1.2,this.verticalScale=l,this.returning=!1,this.flipArc=p,this._startPosition={x:e.x,y:e.y},this.destroyOnReturn=i,this.hitRadius=t}update(e){if(!this.isActive)return;this.totalTime+=e;let a=this.totalTime/this.arcDuration;a>1&&(a=1);let n=Math.PI*a;this.returning&&(n=Math.PI+Math.PI*a);let o=this.towerPosition.x-128;this.flipArc&&(o=this.towerPosition.x+128);const r=this.towerPosition.y,s=this.arcRadius,p=this.arcRadius*this.verticalScale,c=o+(this.flipArc?-1:1)*s*Math.cos(n),l=r+p*Math.sin(n);if(this.position.x=c,this.position.y=l,this.sprite&&(this.sprite.x=c,this.sprite.y=l,this.sprite.rotation+=.25,!this.isActive&&this.sprite.visible)){this.sprite.visible=!1;try{this.sprite.destroy()}catch{}this.sprite=null}if(typeof window<"u"&&window.sceneRef&&Array.isArray(window.sceneRef.gameLogic?.enemies))for(const i of window.sceneRef.gameLogic.enemies){if(!i||!i.isActive)continue;const t=this.hitRadius||36,d=this.position.x-i.position.x,g=this.position.y-i.position.y;Math.sqrt(d*d+g*g)<t&&typeof i.takeDamage=="function"&&i.takeDamage(1)}if(!this.returning&&a>=1&&(this.returning=!0,this.totalTime=0),this.returning&&this.destroyOnReturn&&Math.hypot(this.position.x-this._startPosition.x,this.position.y-this._startPosition.y)<34){if(this.isActive=!1,this.sprite){this.sprite.visible=!1;try{this.sprite.destroy()}catch{}this.sprite=null}if(typeof window<"u"&&window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)){const t=window.sceneRef.gameLogic.projectiles.indexOf(this);t!==-1&&window.sceneRef.gameLogic.projectiles.splice(t,1)}}}onHit(e){}}class f extends m{applyUpgrade(e){e==="quadruple_boomerang"&&(this.hasQuadrupleBoomerang=!0,this.quadrupleBoomerangArc={arcRadius:110,verticalScale:.9}),e==="triple_boomerang"&&(this.hasTripleBoomerang=!0,this.tripleBoomerangArc={arcRadius:160,verticalScale:.5}),e==="bigger_range"?this.range+=40:e==="even_bigger_range"?this.range+=60:e==="world_wide_range"&&(this.range+=120),e==="attack_speed_1"?this.fireRate+=.7:e==="attack_speed_2"?this.fireRate+=.7:e==="attack_speed_3"&&(this.fireRate+=.7),super.applyUpgrade&&super.applyUpgrade(e),this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range),e==="double_boomerang"&&(this.hasDoubleBoomerang=!0,this.doubleBoomerangArc={arcRadius:140,verticalScale:.7})}update(e,a){let n=Date.now()/1e3;!(a&&a.some(r=>r&&r.isActive&&this.isInRange(r)))&&this._placedSprite&&(this._placedSprite.anims&&this._placedSprite.anims.isPlaying&&this._placedSprite.anims.stop(),typeof this._placedSprite.setFrame=="function"&&this._placedSprite.setFrame(1)),this.fire(a,n)}fire(e,a){this.acquireTarget(e);const n=this.boomerangArcDuration||1.2;let o=null;if(this.target&&this.target.position&&(o=this.target.position.x,this.target.velocity&&typeof this.target.velocity.x=="number"&&(o+=this.target.velocity.x*n)),this.target&&a-this.lastShotTime>=1/this.fireRate){this.lastShotTime=a,this._placedSprite&&o!==null&&(o>this.position.x?this._placedSprite.setFlipX(!0):this._placedSprite.setFlipX(!1)),this._placedSprite&&this._placedSprite.playAttack&&this._placedSprite.playAttack();const r={speed:400,sprite:"boomerang_projectile"},s={x:this.position.x,y:this.position.y};if(!this.target||!this.target.position)return;this.target.position.x-s.x,this.target.position.y-s.y,this.upgrades&&this.upgrades.includes("triple_boomerang")||this.upgrades&&this.upgrades.includes("double_boomerang");const p=this.target&&o>this.position.x,c=new h({position:{...s},towerPosition:{...this.position},speed:r.speed,texture:"boomerang_projectile",sourceTower:this,arcDuration:n,flipArc:p}),l=window.sceneRef.add.sprite(s.x,s.y,r.sprite);l.setDisplaySize(24,24),l.setScale(.4),l.setDepth(3001),c.sprite=l,this.projectiles.push(c),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(c),this.hasDoubleBoomerang&&setTimeout(()=>{const i=new h({position:{...s},towerPosition:{...this.position},speed:r.speed,texture:"boomerang_projectile",sourceTower:this,arcDuration:n,flipArc:p,arcRadius:this.doubleBoomerangArc.arcRadius,verticalScale:this.doubleBoomerangArc.verticalScale}),t=window.sceneRef.add.sprite(s.x,s.y,r.sprite);t.setDisplaySize(24,24),t.setScale(.4),t.setDepth(3001),i.sprite=t,this.projectiles.push(i),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(i)},500),this.hasTripleBoomerang&&setTimeout(()=>{const i=new h({position:{...s},towerPosition:{...this.position},speed:r.speed,texture:"boomerang_projectile",sourceTower:this,arcDuration:n,flipArc:p,arcRadius:this.tripleBoomerangArc.arcRadius,verticalScale:this.tripleBoomerangArc.verticalScale,destroyOnReturn:!0}),t=window.sceneRef.add.sprite(s.x,s.y,r.sprite);t.setDisplaySize(24,24),t.setScale(.4),t.setDepth(3001),i.sprite=t,this.projectiles.push(i),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(i)},800),this.hasQuadrupleBoomerang&&setTimeout(()=>{const i=new h({position:{...s},towerPosition:{...this.position},speed:r.speed,texture:"boomerang_projectile",sourceTower:this,arcDuration:n,flipArc:p,arcRadius:this.quadrupleBoomerangArc.arcRadius,verticalScale:this.quadrupleBoomerangArc.verticalScale,destroyOnReturn:!0}),t=window.sceneRef.add.sprite(s.x,s.y,r.sprite);t.setDisplaySize(24,24),t.setScale(.4),t.setDepth(3001),i.sprite=t,this.projectiles.push(i),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(i)},1200)}}constructor({position:e,range:a=220,fireRate:n=1.1,damage:o=40,cost:r=650,type:s="projectile",boomerangArcDuration:p=1.2,...c}){super({position:e,range:a,fireRate:n,damage:o,cost:r,type:s,placedImageKey:"kangaroo_anim",shopImageKey:"kangaroo_shop",projectileKey:"boomerang_projectile",projectileClass:"BoulderProjectile",towerType:"boomerang",class:"BoomerangTower",...c}),this.boomerangArcDuration=p}static placeOnScene(e,a,n){const o=e&&e.towerConfig?e.towerConfig:null;let r=220,s=1.1,p=1.2;o&&o.boomerang&&(o.boomerang.range&&(r=o.boomerang.range),o.boomerang.fireRate&&(s=o.boomerang.fireRate),o.boomerang.boomerangArcDuration&&(p=o.boomerang.boomerangArcDuration));const c=new f({position:{x:a,y:n},range:r,fireRate:s,boomerangArcDuration:p}),l=516*.14,i=800*.14;e.anims.exists("boomerang_attack")||e.anims.create({key:"boomerang_attack",frames:e.anims.generateFrameNumbers("kangaroo_anim",{start:0,end:2}),frameRate:8,repeat:0});const t=e.add.sprite(a,n,"kangaroo_anim",1).setDisplaySize(l,i).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});return t.towerType="boomerang",t.towerX=a,t.towerY=n,t.towerRange=r,c._placedSprite=t,t.setFrame(1),c._isAttacking=!1,c._placedSprite.playIdle=function(){this.anims.stop(),this.setFrame(1)},c._placedSprite.playAttack=function(){this.anims.play("boomerang_attack"),this.once("animationcomplete",()=>{this.setFrame(1)})},c}playAttackAnim(){this._placedSprite&&this._placedSprite.playAttack&&this._placedSprite.playAttack()}playIdleAnim(){this._placedSprite&&this._placedSprite.playIdle&&this._placedSprite.playIdle()}}export{f as BoomerangTower};
