import{ProjectileTower as u}from"./ProjectileTower-CQJWHYe5.js";import{B as w}from"./BoulderProjectile-DaDxGvld.js";import"./index-CJkRmt_y.js";import"./Projectile-BlnVoN5p.js";class f extends u{constructor(t,i,s,e){console.log("StarTower constructor scene:",t),console.log("StarTower constructor scene.physics:",t?.physics),e=e||{},e.position={x:i,y:s},e.fireRate||(e.fireRate=1.5),super(e),this.scene=t,this.config=e,this.towerType="star",this.towerX=i,this.towerY=s,this._sprite&&this._sprite.anims&&this._sprite.setFrame(0),this._isAttacking=!1,this.projectiles=[]}fire(t,i){const s=this.config?.assets?.animation?.key||"star_tower_anim",e=this._placedSprite||this._sprite;if(e&&e.anims&&(e.anims.play({key:s,startFrame:0,repeat:0},!0),e.once("animationcomplete",()=>{e.setFrame(0)})),!this.scene||!this.scene.add){console.error("Scene or scene.add is undefined in StarTower.fire");return}let r=6;this.upgrades&&this.upgrades.includes("double_spike")&&(r=8),this.upgrades&&this.upgrades.includes("triple_spike")&&(r=10),this.upgrades&&this.upgrades.includes("quadruple_spike")&&(r=12);const o={speed:200,hitRadius:36,sprite:"boulder"};for(let a=0;a<r;a++){const l=2*Math.PI/r*a,m={x:Math.cos(l),y:Math.sin(l)},h={x:this.position.x,y:this.position.y},p=new w({position:{...h},direction:m,speed:o.speed,damage:this.damage||1,texture:o.sprite,target:null,hitRadius:o.hitRadius,homing:!1,maxHits:1,showExplosion:!1});p.onHit=function(n){if(n&&typeof n.takeDamage=="function"){let d=this.damage;(n.type==="boss"||n.constructor?.name==="BossBloon")&&(d=Math.round(this.damage*4)),n.takeDamage(d)}this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null)};const c=window.sceneRef.add.sprite(h.x,h.y,o.sprite);c.setDisplaySize(14,14),c.setScale(.45),c.setDepth(3001),p.sprite=c,this.projectiles.push(p),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(p)}}update(t,i){let s=Date.now()/1e3;this.acquireTarget(i),this.target&&(!this.lastShotTime||s-this.lastShotTime>=1/(this.fireRate||1))&&(this.lastShotTime=s,this.fire(i,s));for(const e of this.projectiles)e&&typeof e.update=="function"&&e.update(t)}applyUpgrade(t){(t==="attack_speed_1"||t==="attack_speed_2"||t==="attack_speed_3")&&(this.fireRate+=.5,console.log(`StarTower upgraded: ${t}, new fireRate: ${this.fireRate}`)),this.upgrades.push(t)}static placeOnScene(t,i,s){console.log("StarTower.placeOnScene scene:",t),console.log("StarTower.placeOnScene scene.physics:",t?.physics);let e={};t&&t.towerConfig&&t.towerConfig.star&&(e={...t.towerConfig.star}),e.position={x:i,y:s};const r=new f(t,i,s,e),o=e.assets?.animation?.key||"star_tower_anim";e.assets?.animation?.frameWidth,e.assets?.animation?.frameHeight;const a=t.add.sprite(i,s,"star_placed",0).setScale(.12).setDepth(20).setAlpha(1).setInteractive({useHandCursor:!0});return a.towerType="star",a.towerX=i,a.towerY=s,a.towerRange=r.range,t.anims.exists(o)||t.anims.create({key:o,frames:t.anims.generateFrameNumbers("star_anim",{start:0,end:2}),frameRate:e.assets?.animation?.frameRate||12,repeat:0}),a.setFrame(0),r._placedSprite=a,r}}export{f as StarTower};
