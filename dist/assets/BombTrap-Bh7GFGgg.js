class h{static placeOnScene(s,e,t){return new h(s,e,t)}constructor(s,e,t){this.scene=s,this.x=e,this.y=t,this.active=!0,this.exploded=!1,this.sprite=s.add.sprite(e,t,"bomb_trap"),this.sprite.setDisplaySize(69,69),this.sprite.setDepth(9e3),this.sprite.setOrigin(.5,.5),this.sprite.bombRef=this,this._placedSprite=this.sprite,this.towerType="bomb_trap",this.unlockedUpgrades={left:0,right:0},this._flashState=!1,this._flashInterval=setInterval(()=>{this.sprite&&(this._flashState=!this._flashState,this._flashState?this.sprite.setTint(16720418):this.sprite.clearTint())},120),this._explodeTimeout=setTimeout(()=>{this.explode()},2e3)}update(){}explode(){if(!this.active||this.exploded)return;if(this.exploded=!0,this.active=!1,this._flashInterval&&(clearInterval(this._flashInterval),this._flashInterval=null),this.sprite){this.sprite.clearTint(),this.sprite.setTexture("bomb_anim"),typeof this.sprite.play=="function"&&this.sprite.play("bomb_idle"),this.scene.sound&&typeof this.scene.sound.play=="function"&&this.scene.sound.play("boom");const t=this.scene.anims.get("bomb_idle"),i=t?t.frames.length/(t.frameRate||1)*1e3:400;setTimeout(()=>{this.destroy()},i)}const s=120,e=3;if(this.scene&&this.scene.gameLogic&&Array.isArray(this.scene.gameLogic.enemies))for(const t of this.scene.gameLogic.enemies){if(!t||!t.isActive)continue;const i=(t.position?.x??t.x??0)-this.x,a=(t.position?.y??t.y??0)-this.y;Math.sqrt(i*i+a*a)<=s&&(typeof t.takeDamage=="function"?t.takeDamage(e,"bomb_trap"):typeof t.damage=="number"&&(t.damage-=e,t.damage<=0&&typeof t.destroy=="function"&&(t.destroy(),t.isActive=!1)))}}destroy(){this.active=!1,this._explodeTimeout&&(clearTimeout(this._explodeTimeout),this._explodeTimeout=null),this._flashInterval&&(clearInterval(this._flashInterval),this._flashInterval=null),this.sprite&&(this.sprite.destroy(),this.sprite=null)}}export{h as BombTrap};
