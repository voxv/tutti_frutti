import{A as S,t as c}from"./index-CLJ39ZyJ.js";class f extends S{static debugSetFrame(i,t,s){i&&typeof i.setFrame=="function"&&i.setFrame(t)}applyUpgrade(i){if(i==="penetration_2"&&this._laserSprite){const t=this._laserSprite.displayWidth,s=this._laserSprite.displayHeight;this._laserSprite.setDisplaySize(t+15,s+15)}if(i==="bigger_range"||i==="even_bigger_range"){if(this.range+=17,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range),this._laserSprite){const t=this._laserSprite.displayWidth,s=this._laserSprite.displayHeight;this._laserSprite.setDisplaySize(t+10,s+10)}window.sceneRef&&window.sceneRef.refreshUpgradeUIIfVisible&&window.sceneRef.refreshUpgradeUIIfVisible()}else if(i==="world_wide_range")this.range+=100,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range),window.sceneRef&&window.sceneRef.refreshUpgradeUIIfVisible&&window.sceneRef.refreshUpgradeUIIfVisible();else if(i==="attack_speed_1"){if(this.fireRate+=15,this._laserSprite&&this._laserSprite.anims&&this._laserSprite.anims.currentAnim){const t=this._laserSprite.anims.currentAnim;t&&typeof t.frameRate=="number"&&(t.frameRate+=5)}this._placedSprite&&this._placedSprite.towerFireRate!==void 0&&(this._placedSprite.towerFireRate=this.fireRate)}this.upgrades||(this.upgrades=[]),this.upgrades.push(i)}update(i,t){const s=t.filter(e=>e&&e.isActive&&this.isInRange(e));if(this._laserSprite){this._laserSprite.x=this.position.x+this.laserOffsetX,this._laserSprite.y=this.position.y+this.laserOffsetY;const e=performance.now();s.length>0?(this._lastLaserActiveTime=e,this._laserSprite.visible||this._laserSprite.setVisible(!0),this._laserSprite.anims.isPlaying||this._laserSprite.play("laser_shooter_anim",!0),this._placedSprite&&this._placedSprite.anims&&(!this._placedSprite.anims.isPlaying||this._placedSprite.anims.currentAnim?.key!=="laser_tower_idle")&&typeof this._placedSprite.play=="function"&&this._placedSprite.play("laser_tower_idle"),window.sceneRef&&window.sceneRef.sound&&window.sceneRef.sound.play&&e-this._lastBzzTime>2e3&&(window.sceneRef.sound.play("bzz"),this._lastBzzTime=e),this._laserBeamShouldBeVisible=!0):(this._lastLaserActiveTime||(this._lastLaserActiveTime=e),e-this._lastLaserActiveTime>250&&(f.debugSetFrame(this._laserSprite,0,"laser_shooter_anim stopped"),this._laserSprite.setVisible(!1),this._placedSprite&&this._placedSprite.anims&&(this._placedSprite.anims.isPlaying&&this._placedSprite.anims.stop(),this._placedSprite.setFrame(0),f.debugSetFrame(this._placedSprite,0,"placedSprite anim stopped")),this._laserBeamShouldBeVisible=!1))}for(const e of s)if(!(e._laserSpawnCooldownUntil&&performance.now()<e._laserSpawnCooldownUntil)&&(!e._lastLaserHitTime||performance.now()-e._lastLaserHitTime>200)){let d=e.isActive;if(e.health-this.damage<=0){this.upgrades&&(e._laserTowerUpgrades=Array.isArray(this.upgrades)?[...this.upgrades]:[]);const a=this.upgrades&&this.upgrades.includes("penetration"),o=this.upgrades&&this.upgrades.includes("penetration_2");e.takeDamage("LASER_KILL"),(a||o)&&window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.enemies)&&setTimeout(()=>{function p(r,l=[]){let _=0;const g=10,m=()=>{const h=window.sceneRef.gameLogic.enemies.filter(n=>n&&n.isActive&&n.constructor&&n.constructor.name.toLowerCase().includes(r.toLowerCase())&&n.position&&e.position&&n.position.x===e.position.x&&n.position.y===e.position.y&&!l.includes(n));h.length>0&&typeof h[0].takeDamage=="function"?h[0].takeDamage("LASER_KILL"):_<g&&(_++,setTimeout(m,30))};m()}e.nextTypes.length>0&&p(e.nextTypes[0]),o&&e.nextTypes.length>1&&setTimeout(()=>{p(e.nextTypes[1])},60)},60)}else e.takeDamage(this.damage);d&&!e.isActive&&typeof e.reward=="number"&&window.sceneRef&&(window.sceneRef.goldAmount+=e.reward,window.sceneRef.goldText&&window.sceneRef.goldText.setText(String(window.sceneRef.goldAmount))),e._lastLaserHitTime=performance.now()}super.update(i,t)}constructor(i={}){let t={range:200,fireRate:3,damage:3,cost:350,type:"aoe"};c&&c.laser&&(t={...t,...c.laser}),super({...t,...i,type:"aoe"}),this._lastBzzTime=0,this._laserBeamShouldBeVisible=!0}static placeOnScene(i,t,s){let e=100;i&&i.towerConfig&&i.towerConfig.laser&&i.towerConfig.laser.range&&(e=i.towerConfig.laser.range);const a=i.add.sprite(t,s,"laser_placed",0).setDisplaySize(351*.19,248*.19).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});a.setFrame(0),a.towerType="laser",a.towerX=t,a.towerY=s,a.towerRange=e;const o=10,p=-10,r=i.add.sprite(t+o,s+p,"laser_anim");r.setDisplaySize(120,120),r.setDepth(3001),r.setRotation(Math.PI),r.play("laser_shooter_anim",!0),r.setVisible(!1);const l=new f({position:{x:t,y:s},range:e});return l._placedSprite=a,l.laserOffsetX=o,l.laserOffsetY=p,l._laserSprite=r,l}fire(i,t){}}export{f as LaserTower};
