class a{constructor({position:o,direction:e,speed:t,damage:i,texture:s,target:n,hitRadius:h=36,homing:p=!1}){this.position={...o},this.direction=e,this.speed=t,this.damage=i,this.texture=s,this.target=n,this.isActive=!0,this.hitRadius=h,this.homing=p,this.sprite=null}onHit(o){o&&typeof o.takeDamage=="function"&&o.takeDamage(this.damage),this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null)}update(o){if(!this.isActive)return;if(this.homing){if((!this.target||!this.target.isActive)&&(this.target=null,typeof window<"u"&&window.sceneRef&&window.sceneRef.gameLogic&&window.sceneRef.gameLogic.enemies)){const t=window.sceneRef.gameLogic.enemies.filter(i=>i&&i.isActive&&i.position&&Math.hypot(i.position.x-this.position.x,i.position.y-this.position.y)<500);t.length>0&&(this.target=t.reduce((i,s)=>{const n=Math.hypot(i.position.x-this.position.x,i.position.y-this.position.y);return Math.hypot(s.position.x-this.position.x,s.position.y-this.position.y)<n?s:i},t[0]))}if(this.target&&this.target.isActive){const t=this.target.position.x-this.position.x,i=this.target.position.y-this.position.y,s=Math.sqrt(t*t+i*i);s>0&&(this.direction={x:t/s,y:i/s})}}this.position.x+=this.direction.x*this.speed*o,this.position.y+=this.direction.y*this.speed*o,this.sprite&&(this.sprite.x=this.position.x,this.sprite.y=this.position.y);const e=typeof window<"u"?window.sceneRef:null;if(e&&e.pathPoints&&(this.sourceTower?.towerType==="bird"||this.isSniperDrop)){let t=1/0;for(const i of e.pathPoints){const s=this.position.x-i.x,n=this.position.y-i.y,h=Math.sqrt(s*s+n*n);h<t&&(t=h)}if(t<(this.hitRadius||36)){typeof this.destroyOnPath=="function"?this.destroyOnPath(e):(this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null));return}}(this.position.x>1380||this.position.x<0)&&(this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null))}}export{a as P};
