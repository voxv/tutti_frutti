import{ProjectileTower as m}from"./ProjectileTower-B7NrgRxC.js";import{B as u}from"./BoulderProjectile-DaDxGvld.js";import"./index-DYqfCKwm.js";import"./Projectile-BlnVoN5p.js";class d extends m{constructor(t,i,s,e){console.log("StarTower constructor scene:",t),console.log("StarTower constructor scene.physics:",t?.physics),e=e||{},e.position={x:i,y:s},e.fireRate||(e.fireRate=1.5),super(e),this.scene=t,this.config=e,this.towerType="star",this.towerX=i,this.towerY=s,this._sprite&&this._sprite.anims&&this._sprite.setFrame(0),this._isAttacking=!1,this.projectiles=[]}fire(t,i){const s=this.config?.assets?.animation?.key||"star_tower_anim",e=this._placedSprite||this._sprite;if(e&&e.anims&&(e.anims.play({key:s,startFrame:0,repeat:0},!0),e.once("animationcomplete",()=>{e.setFrame(0)})),!this.scene||!this.scene.add){console.error("Scene or scene.add is undefined in StarTower.fire");return}let a=6;this.upgrades&&this.upgrades.includes("double_spike")&&(a=7),this.upgrades&&this.upgrades.includes("triple_spike")&&(a=8),this.upgrades&&this.upgrades.includes("quadruple_spike")&&(a=10);const o={speed:200,hitRadius:36,sprite:"boulder"};for(let r=0;r<a;r++){const l=2*Math.PI/a*r,f={x:Math.cos(l),y:Math.sin(l)},c={x:this.position.x,y:this.position.y},n=new u({position:{...c},direction:f,speed:o.speed,damage:this.damage||1,texture:o.sprite,target:null,hitRadius:o.hitRadius,homing:!1,maxHits:1,showExplosion:!1});n.onHit=function(h){h&&typeof h.takeDamage=="function"&&h.takeDamage(this.damage),this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null)};const p=window.sceneRef.add.sprite(c.x,c.y,o.sprite);p.setDisplaySize(14,14),p.setScale(.45),p.setDepth(3001),n.sprite=p,this.projectiles.push(n),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(n)}}update(t,i){let s=Date.now()/1e3;this.acquireTarget(i),this.target&&(!this.lastShotTime||s-this.lastShotTime>=1/(this.fireRate||1))&&(this.lastShotTime=s,this.fire(i,s));for(const e of this.projectiles)e&&typeof e.update=="function"&&e.update(t)}applyUpgrade(t){(t==="attack_speed_1"||t==="attack_speed_2"||t==="attack_speed_3")&&(this.fireRate+=.5,console.log(`StarTower upgraded: ${t}, new fireRate: ${this.fireRate}`)),this.upgrades.push(t)}static placeOnScene(t,i,s){console.log("StarTower.placeOnScene scene:",t),console.log("StarTower.placeOnScene scene.physics:",t?.physics);let e={};t&&t.towerConfig&&t.towerConfig.star&&(e={...t.towerConfig.star}),e.position={x:i,y:s};const a=new d(t,i,s,e),o=e.assets?.animation?.key||"star_tower_anim";e.assets?.animation?.frameWidth,e.assets?.animation?.frameHeight;const r=t.add.sprite(i,s,"star_placed",0).setScale(.12).setDepth(20).setAlpha(1).setInteractive({useHandCursor:!0});return r.towerType="star",r.towerX=i,r.towerY=s,r.towerRange=a.range,t.anims.exists(o)||t.anims.create({key:o,frames:t.anims.generateFrameNumbers("star_anim",{start:0,end:2}),frameRate:e.assets?.animation?.frameRate||12,repeat:0}),r.setFrame(0),a._placedSprite=r,a}}export{d as StarTower};
