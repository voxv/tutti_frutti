import{ProjectileTower as y}from"./ProjectileTower-Do1mx_Tw.js";import{t as d}from"./index-FuQg_Acl.js";import{p as u}from"./Projectile-DRreVYR2.js";import{B as m,E as b}from"./BoulderProjectile-DfFSEgyH.js";class g extends y{constructor(t={}){let s={range:120,fireRate:1,damage:1,cost:600,type:"bird"};d&&d.bird&&(s={...s,...d.bird}),super({...s,...t,type:"bird"}),this.projectileTexture="boulder",this.homing=t.homing!==void 0?t.homing:!0,this._infinityA=100,this._infinityB=50,this._infinityAngle=0,this._infinitySpeed=Math.PI,this._pendingInfinityAIncrease=0}applyUpgrade(t){t==="devastation_1"?this._devastationNeighbors=1:t==="devastation_2"?this._devastationNeighbors=2:t==="devastation_3"&&(this._devastationNeighbors=3),t==="wide_patrol_1"||t==="wide_patrol_2"||t==="wide_patrol_3"?(typeof this._infinityA=="number"?this._infinityA+=40:this._pendingInfinityAIncrease=(this._pendingInfinityAIncrease||0)+40,typeof this._infinityB=="number"?this._infinityB+=20:this._pendingInfinityBIncrease=(this._pendingInfinityBIncrease||0)+20,this.fireRate+=.5):t==="faster_bird_1"||t==="faster_bird_2"||t==="faster_bird_3"?this.fireRate+=.5:t==="double_shot"?this._doubleShot=!0:t==="triple_shot"?this._tripleShot=!0:t==="super_bird"&&(this.damage+=.5),this.upgrades=this.upgrades||[],this.upgrades.push(t)}update(t,s){if(typeof this._infinityAngle=="number"&&this._pathCenter&&this._placedSprite){this._infinityAngle+=this._infinitySpeed*t;const n=this._infinityA,a=this._infinityB,e=this._pathCenter.x,p=this._pathCenter.y,f=this._infinityAngle;this._placedSprite.x=e+n*Math.sin(f),this._placedSprite.y=p+a*Math.sin(2*f)/2}let o=Date.now()/1e3;this.fire(s,o)}static placeOnScene(t,s,o){const n=t&&t.cache&&t.cache.json&&t.cache.json.get?t.cache.json.get("tower"):null;let a=120;n&&n.bird&&n.bird.range&&(a=n.bird.range);const e=new g({position:{x:s,y:o}}),r=t.add.sprite(s,o,"bird_placed",0).setDisplaySize(100*.9,100*.9).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});return r.play("bird_tower_idle"),r.towerType="bird",r.towerX=s,r.towerY=o,r.towerRange=a,e._placedSprite=r,e._pathCenter={x:s,y:o},typeof e._infinityA!="number"&&(e._infinityA=100),typeof e._infinityB!="number"&&(e._infinityB=50),typeof e._infinityAngle!="number"&&(e._infinityAngle=0),typeof e._infinitySpeed!="number"&&(e._infinitySpeed=Math.PI),e._pendingInfinityAIncrease&&(e._infinityA+=e._pendingInfinityAIncrease,e._pendingInfinityAIncrease=0),r._parentTower=e,e}fire(t,s){if(this.acquireTarget(t),this.target&&s-this.lastShotTime>=1/this.fireRate){this.lastShotTime=s,this._placedSprite&&this._placedSprite.anims&&this._placedSprite.play("bird_tower_idle",!0);const o=u.boulder||{speed:400,hitRadius:36,sprite:"boulder"},n={x:this._placedSprite?.x??this.position.x,y:this._placedSprite?.y??this.position.y};if(!this.target||!this.target.position)return;const a=this.target.position.x-n.x,e=this.target.position.y-n.y,p=Math.sqrt(a*a+e*e),f={x:a/p,y:e/p},r=this._tripleShot?3:this._doubleShot?2:1;let c=this._devastationNeighbors||0,_=[];c>0&&Array.isArray(t)&&this.target&&this.target.position&&(_=t.filter(i=>i!==this.target&&i.position).map(i=>({e:i,dist:Math.hypot(i.position.x-this.target.position.x,i.position.y-this.target.position.y)})).sort((i,h)=>i.dist-h.dist).slice(0,c).map(i=>i.e));for(let i=0;i<r;i++){const h=new m({position:{...n},direction:f,speed:o.speed,damage:this.damage,texture:this.projectileTexture,target:this.target,hitRadius:o.hitRadius,homing:!0,maxHits:1,showExplosion:!0});h.sourceTower=this;const l=window.sceneRef.add.sprite(n.x,n.y,o.sprite);l.setDisplaySize(24,24),l.setScale(.7),l.setDepth(3001),h.sprite=l,this.projectiles.push(h),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(h)}for(const i of _)i&&i.position&&new b({position:{...i.position},damage:0,sourceTower:this}).playExplosion(window.sceneRef),i&&typeof i.takeDamage=="function"?i.type==="boss"||i.constructor?.name==="BossBloon"?i.takeDamage(1,this):i.takeDamage(99999,this):i&&i.health!==void 0&&(i.type==="boss"||i.constructor?.name==="BossBloon"?i.health-=1:i.health=0)}}}export{g as BirdTower};
