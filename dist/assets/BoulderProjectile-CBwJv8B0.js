import{P as c}from"./Projectile-BlnVoN5p.js";import{G as r}from"./index-BY0umbr6.js";class w extends c{constructor({position:e,damage:i=0,sourceTower:o=null}){super({position:e,direction:{x:0,y:0},speed:0,damage:i,texture:null,target:null,hitRadius:0,homing:!1}),this.sourceTower=o}playExplosion(e){if(e&&e.add&&e.anims){const i=e.add.sprite(this.position.x,this.position.y,"explode_anim",0).setDisplaySize(100*r,100*r).setDepth(4e3);if(e.anims.exists("explode_anim"))try{i.play("explode_anim"),i.on("animationcomplete",()=>{i.destroy()})}catch{i.destroy()}else i.destroy()}try{window.sceneRef&&window.sceneRef.sound&&window.sceneRef.sound.play&&window.sceneRef.sound.play("boom")}catch{}}}class x extends c{constructor({position:e,direction:i,speed:o,damage:t,texture:n="boulder",target:a,hitRadius:d=36,homing:l=!1,maxHits:s=1,showExplosion:p=!1}){super({position:e,direction:i,speed:o,damage:t,texture:n,target:a,hitRadius:d,homing:l}),this.maxHits=s,this._hits=0,this.showExplosion=p}_playExplosion(e,i,o){if(this.showExplosion){if(e&&e.add&&e.anims){const t=e.add.sprite(i,o,"explode_anim",0).setDisplaySize(100*r,100*r).setDepth(4e3);if(e.anims.exists("explode_anim"))try{t.play("explode_anim"),t.on("animationcomplete",()=>{t.destroy()})}catch{t.destroy()}else t.destroy()}try{window.sceneRef&&window.sceneRef.sound&&window.sceneRef.sound.play&&window.sceneRef.sound.play("boom")}catch{}}}destroyOnPath(e){if(this.isActive=!1,this.sprite){const i=this.sprite.x,o=this.sprite.y;let t=null;this.sourceTower&&this.sourceTower._devastationNeighbors&&(this.sourceTower._devastationNeighbors,t=this.sourceTower);let n=120;if(this.isSniperDrop&&(n=150,(this.piercingShot||this.sourceTower&&this.sourceTower._piercingShot)&&(n=250)),e&&Array.isArray(e.gameLogic?.enemies)){const a=i,d=o,l=e.gameLogic.enemies.filter(s=>s&&s.isActive&&s.position);for(const s of l)if(Math.hypot(s.position.x-a,s.position.y-d)<=n)if(s&&typeof s.takeDamage=="function"){let f=this.isSniperDrop?this.damage:99999;s.takeDamage(f,t)}else s&&s.health!==void 0&&(s.health=0)}this.sprite.destroy(),this.sprite=null,this._playExplosion(e,i,o)}}onHit(e){if(e&&typeof e.takeDamage=="function"){let i=this.damage;this.sourceTower&&this.sourceTower.towerType==="bird"&&(e.constructor?.name==="BossBloon"||e.type==="boss")&&(i=Math.round(this.damage*4)),e.takeDamage(i)}if(e&&!e.isActive&&!(e.isAtEnd&&e.isAtEnd())&&typeof window.sceneRef=="object"&&window.sceneRef&&(window.sceneRef.sound&&window.sceneRef.sound.play&&window.sceneRef.sound.play("squirt"),window.sceneRef.goldAmount+=e.reward,window.sceneRef.goldText&&window.sceneRef.goldText.setText(String(window.sceneRef.goldAmount)),typeof window.sceneRef._refreshShopAvailability=="function"&&window.sceneRef._refreshShopAvailability()),this._hits++,this._hits>=this.maxHits&&(this.isActive=!1,this.sprite)){const i=this.sprite.x,o=this.sprite.y;this.sprite.destroy(),this.sprite=null,this.sourceTower&&this.sourceTower.towerType==="bird"?new w({position:{x:i,y:o},damage:0,sourceTower:this.sourceTower}).playExplosion(window.sceneRef):this._playExplosion(window.sceneRef,i,o)}}}export{x as B,w as E};
