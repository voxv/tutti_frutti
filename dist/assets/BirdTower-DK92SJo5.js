import{ProjectileTower as u}from"./ProjectileTower-DpRX_KKh.js";import{t as d,G as g}from"./index-5Gah5Vdj.js";import{p as m}from"./projectiles-CDq3D0-e.js";import{B as b,E as w}from"./BoulderProjectile-Bxzy0DQd.js";import"./Projectile-BlnVoN5p.js";class y extends u{constructor(i={}){let s={range:120,fireRate:1,damage:1,cost:600,type:"bird"};d&&d.bird&&(s={...s,...d.bird}),super({...s,...i,type:"bird"}),this.projectileTexture="boulder",this.homing=i.homing!==void 0?i.homing:!0,this._infinityA=100,this._infinityB=50,this._infinityAngle=0,this._infinitySpeed=Math.PI,this._pendingInfinityAIncrease=0}applyUpgrade(i){i==="devastation_1"?this._devastationNeighbors=1:i==="devastation_2"?this._devastationNeighbors=2:i==="devastation_3"&&(this._devastationNeighbors=3),i==="wide_patrol_1"||i==="wide_patrol_2"||i==="wide_patrol_3"?(typeof this._infinityA=="number"?this._infinityA+=40:this._pendingInfinityAIncrease=(this._pendingInfinityAIncrease||0)+40,typeof this._infinityB=="number"?this._infinityB+=20:this._pendingInfinityBIncrease=(this._pendingInfinityBIncrease||0)+20,this.fireRate+=.5):i==="faster_bird_1"||i==="faster_bird_2"||i==="faster_bird_3"?this.fireRate+=.5:i==="double_shot"?this._doubleShot=!0:i==="triple_shot"?this._tripleShot=!0:i==="super_bird"&&(this.damage+=.5),this.upgrades=this.upgrades||[],this.upgrades.push(i)}update(i,s){if(typeof this._infinityAngle=="number"&&this._pathCenter&&this._placedSprite){this._infinityAngle+=this._infinitySpeed*i;const n=this._infinityA,a=this._infinityB,e=this._pathCenter.x,p=this._pathCenter.y,f=this._infinityAngle;this._placedSprite.x=e+n*Math.sin(f),this._placedSprite.y=p+a*Math.sin(2*f)/2}let o=Date.now()/1e3;this.fire(s,o)}static placeOnScene(i,s,o){const n=i&&i.cache&&i.cache.json&&i.cache.json.get?i.cache.json.get("tower"):null;let a=120;n&&n.bird&&n.bird.range&&(a=n.bird.range);const e=new y({position:{x:s,y:o}}),r=i.add.sprite(s,o,"bird_placed",0).setDisplaySize(100*.9,100*.9).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});return r.play("bird_tower_idle"),r.towerType="bird",r.towerX=s,r.towerY=o,r.towerRange=a,e._placedSprite=r,e._pathCenter={x:s,y:o},typeof e._infinityA!="number"&&(e._infinityA=100),typeof e._infinityB!="number"&&(e._infinityB=50),typeof e._infinityAngle!="number"&&(e._infinityAngle=0),typeof e._infinitySpeed!="number"&&(e._infinitySpeed=Math.PI),e._pendingInfinityAIncrease&&(e._infinityA+=e._pendingInfinityAIncrease,e._pendingInfinityAIncrease=0),r._parentTower=e,e}fire(i,s){if(this.acquireTarget(i),this.target&&s-this.lastShotTime>=1/this.fireRate){this.lastShotTime=s,this._placedSprite&&this._placedSprite.anims&&this._placedSprite.play("bird_tower_idle",!0);const o=m.boulder||{speed:400,hitRadius:36,sprite:"boulder"},n={x:this._placedSprite?.x??this.position.x,y:this._placedSprite?.y??this.position.y};if(!this.target||!this.target.position)return;const a=this.target.position.x-n.x,e=this.target.position.y-n.y,p=Math.sqrt(a*a+e*e),f={x:a/p,y:e/p},r=this._tripleShot?3:this._doubleShot?2:1;let c=this._devastationNeighbors||0,_=[];c>0&&Array.isArray(i)&&this.target&&this.target.position&&(_=i.filter(t=>t!==this.target&&t.position).map(t=>({e:t,dist:Math.hypot(t.position.x-this.target.position.x,t.position.y-this.target.position.y)})).sort((t,h)=>t.dist-h.dist).slice(0,c).map(t=>t.e));for(let t=0;t<r;t++){const h=new b({position:{...n},direction:f,speed:o.speed,damage:this.damage,texture:this.projectileTexture,target:this.target,hitRadius:o.hitRadius,homing:!0,maxHits:1,showExplosion:!0});h.sourceTower=this;const l=window.sceneRef.add.sprite(n.x,n.y,o.sprite);l.setDisplaySize(24*g,24*g),l.setScale(.7),l.setDepth(3001),h.sprite=l,this.projectiles.push(h),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(h)}for(const t of _)t&&t.position&&new w({position:{...t.position},damage:0,sourceTower:this}).playExplosion(window.sceneRef),t&&typeof t.takeDamage=="function"?t.type==="boss"||t.constructor?.name==="BossBloon"?t.takeDamage(1,this):t.takeDamage(99999,this):t&&t.health!==void 0&&(t.type==="boss"||t.constructor?.name==="BossBloon"?t.health-=1:t.health=0)}}}export{y as BirdTower};
