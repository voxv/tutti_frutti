import{ProjectileTower as g}from"./ProjectileTower-Bjgwosi0.js";import{t as l}from"./index-D48ifzYb.js";import{p as f}from"./projectiles-CDq3D0-e.js";import{P as u}from"./Projectile-BlnVoN5p.js";class w extends u{update(t){if(this.isActive){if(this.homing&&this.target&&this.target.isActive){const i=this.target.position.x-this.position.x,s=this.target.position.y-this.position.y,o=Math.sqrt(i*i+s*s);o>0&&(this.direction={x:i/o,y:s/o})}this.position.x+=this.direction.x*this.speed*t,this.position.y+=this.direction.y*this.speed*t,this.sprite&&(this.sprite.x=this.position.x,this.sprite.y=this.position.y),(this.position.x>1380||this.position.x<0)&&(this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null))}}constructor(t){super(t),this.slowAmount=t.slowAmount||.5,this.slowDuration=t.slowDuration||2.5,this.stickinessLevel=t.stickinessLevel||0,this.tower=t.tower}onHit(t){t&&typeof t.applySlow=="function"&&(t.applySlow(this.slowAmount,this.slowDuration),this.stickinessLevel>0&&this.tower&&window.sceneRef&&window.sceneRef.gameLogic&&this.spreadStickiness(t,this.stickinessLevel,window.sceneRef.gameLogic.enemies)),super.onHit(t)}spreadStickiness(t,i,s){if(!t||!s||i<=0)return;const o=150,r=s.filter(e=>{if(!e||!e.isActive||e===t||!e.position||!t.position)return!1;const n=e.position.x-t.position.x,h=e.position.y-t.position.y;return Math.sqrt(n*n+h*h)<=o});r.sort((e,n)=>{const h=Math.sqrt(Math.pow(e.position.x-t.position.x,2)+Math.pow(e.position.y-t.position.y,2)),a=Math.sqrt(Math.pow(n.position.x-t.position.x,2)+Math.pow(n.position.y-t.position.y,2));return h-a});for(let e=0;e<Math.min(i,r.length);e++)r[e]&&typeof r[e].applySlow=="function"&&r[e].applySlow(this.slowAmount,this.slowDuration)}}class d extends g{constructor(t={}){let i={range:130,fireRate:1.2,damage:0,cost:280,type:"glue",homing:!1};l&&l.glue&&(i={...i,...l.glue}),super({...i,...t,type:"glue"}),this.projectileTexture="glue_projectile",this.homing=t.homing!==void 0?t.homing:i.homing,this.stickinessLevel=0,this.lastTarget=null}applyUpgrade(t){t==="bigger_range"||t==="even_bigger_range"?(this.range+=50,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range)):t==="super_glue"?(this.range=500,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range)):t==="fast_shooting"?(this.fireRate=2,this._placedSprite&&this._placedSprite.towerFireRate!==void 0&&(this._placedSprite.towerFireRate=this.fireRate)):t==="more_stickiness_1"?this.stickinessLevel=Math.max(this.stickinessLevel,1):t==="more_stickiness_2"?this.stickinessLevel=Math.max(this.stickinessLevel,2):t==="more_stickiness_3"&&(this.stickinessLevel=Math.max(this.stickinessLevel,5)),this.upgrades.push(t)}update(t,i){let s=Date.now()/1e3;!(i&&i.some(r=>r&&r.isActive&&this.isInRange(r)))&&this._placedSprite&&(this._placedSprite.anims&&this._placedSprite.anims.isPlaying&&this._placedSprite.anims.stop(),typeof this._placedSprite.setFrame=="function"&&this._placedSprite.setFrame(0)),this.fire(i,s)}acquireTarget(t){if(super.acquireTarget(t),this.targetingPriority==="First"&&this.lastTarget&&this.target===this.lastTarget&&t&&Array.isArray(t)){const i=t.filter(s=>s&&s.isActive&&this.isInRange(s));if(i.length>1){const s=i.find(o=>o!==this.lastTarget);s&&(this.target=s)}}}static placeOnScene(t,i,s){const o=t&&t.cache&&t.cache.json&&t.cache.json.get?t.cache.json.get("tower"):null;let r=130;o&&o.glue&&o.glue.range&&(r=o.glue.range);const e=new d({position:{x:i,y:s}}),n=220/2,a=t.add.sprite(i,s,"glue_placed").setDisplaySize(n*.6,100*.6).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});return a.towerType="glue",a.towerX=i,a.towerY=s,a.towerRange=r,e._placedSprite=a,e}fire(t,i){if(this.acquireTarget(t),this.target&&i-this.lastShotTime>=1/this.fireRate){this.lastShotTime=i,this.lastTarget=this.target,this._placedSprite&&this._placedSprite.anims&&this._placedSprite.anims.play("glue_tower_anim",!0);const s=f.glue||{speed:500,hitRadius:24,sprite:"glue_projectile"},o={x:this.position.x,y:this.position.y};if(!this.target||!this.target.position)return;const r=this.target.position.x-o.x,e=this.target.position.y-o.y,n=Math.sqrt(r*r+e*e),h={x:r/n,y:e/n};let a=1;const c=new w({position:{...o},direction:h,speed:s.speed,damage:this.damage,texture:this.projectileTexture,target:this.target,hitRadius:s.hitRadius,homing:this.homing,maxHits:a,slowAmount:.5,slowDuration:2.5,stickinessLevel:this.stickinessLevel,tower:this}),p=window.sceneRef.add.sprite(o.x,o.y,s.sprite);p.setDisplaySize(24,24),p.setScale(.7),p.setDepth(3001),c.sprite=p,window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(c)}}}export{d as GlueTower};
