import{T as l}from"./Tower-Cv7v0p7_.js";import{t as f}from"./index-bdZKAPju.js";class g extends l{constructor(e={}){super({...e,type:"projectile"}),this.projectiles=[]}acquireTarget(e){for(const t of e)if(t.isActive&&this.isInRange(t))return this.target=t,t;return this.target=null,null}fire(e,t){if((!this.target||!this.isInRange(this.target))&&this.acquireTarget(e),this.target&&t-this.lastShotTime>=1/this.fireRate){this.lastShotTime=t;const s={position:{...this.position},target:this.target,damage:this.damage,onHit:function(i){i.takeDamage(this.damage),this.isActive=!1,!i.isActive&&!(i.isAtEnd&&i.isAtEnd())&&typeof window.sceneRef=="object"&&window.sceneRef&&(window.sceneRef.goldAmount+=i.reward,window.sceneRef.goldText&&window.sceneRef.goldText.setText(String(window.sceneRef.goldAmount)),typeof window.sceneRef._refreshShopAvailability=="function"&&window.sceneRef._refreshShopAvailability(),typeof window.sceneRef.refreshUpgradeUIIfVisible=="function"&&window.sceneRef.refreshUpgradeUIIfVisible())}};if(this.projectiles.push(s),typeof window.sceneRef=="object"&&window.sceneRef){const i=window.sceneRef.add.circle(this.position.x,this.position.y,this.range*.5,16746496,.4);i.setDepth(3e3),window.sceneRef.tweens.add({targets:i,alpha:0,scale:2,duration:200,onComplete:()=>i.destroy()})}}}update(e,t){let s=Date.now()/1e3;this.fire(t,s)}}const w={speed:1054,hitRadius:36,sprite:"boulder"},u={boulder:w};class R{constructor({position:e,direction:t,speed:s,damage:i,texture:o,target:n,hitRadius:a=36,homing:h=!1}){this.position={...e},this.direction=t,this.speed=s,this.damage=i,this.texture=o,this.target=n,this.isActive=!0,this.hitRadius=a,this.homing=h,this.sprite=null}onHit(e){e&&typeof e.takeDamage=="function"&&e.takeDamage(this.damage),this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null)}update(e){if(this.isActive){if(this.homing&&this.target&&this.target.isActive){const t=this.target.position.x-this.position.x,s=this.target.position.y-this.position.y,i=Math.sqrt(t*t+s*s);i>0&&(this.direction={x:t/i,y:s/i})}this.position.x+=this.direction.x*this.speed*e,this.position.y+=this.direction.y*this.speed*e,this.sprite&&(this.sprite.x=this.position.x,this.sprite.y=this.position.y)}}}class x extends R{constructor({position:e,direction:t,speed:s,damage:i,texture:o="boulder",target:n,hitRadius:a=36,homing:h=!1}){super({position:e,direction:t,speed:s,damage:i,texture:o,target:n,hitRadius:a,homing:h})}}class A extends g{constructor(e={}){let t={range:150,fireRate:1.5,damage:3,cost:350,type:"cannon",homing:!1};f&&f.cannon&&(t={...t,...f.cannon}),super({...t,...e,type:"cannon"}),this.projectileTexture="boulder",this.homing=e.homing!==void 0?e.homing:t.homing}acquireTarget(e){for(const t of e)if(t.isActive&&this.isInRange(t))return this.target=t,t;return this.target=null,null}fire(e,t){if(this.acquireTarget(e),this.target&&t-this.lastShotTime>=1/this.fireRate){this.lastShotTime=t;const s=u.boulder||{speed:400,hitRadius:36,sprite:"boulder"},i={x:this.position.x-20,y:this.position.y-20},o=this.target.position.x-i.x,n=this.target.position.y-i.y,a=Math.sqrt(o*o+n*n),h={x:o/a,y:n/a},c=new x({position:{...i},direction:h,speed:s.speed,damage:this.damage,texture:this.projectileTexture,target:this.target,hitRadius:s.hitRadius,homing:this.homing});c.onHit=function(r){r&&typeof r.takeDamage=="function"&&r.takeDamage(this.damage),this.isActive=!1,this.sprite&&(this.sprite.destroy(),this.sprite=null),!r.isActive&&!(r.isAtEnd&&r.isAtEnd())&&typeof window.sceneRef=="object"&&window.sceneRef&&(window.sceneRef.goldAmount+=r.reward,window.sceneRef.goldText&&window.sceneRef.goldText.setText(String(window.sceneRef.goldAmount)),typeof window.sceneRef._refreshShopAvailability=="function"&&window.sceneRef._refreshShopAvailability())};const p=window.sceneRef.add.sprite(i.x,i.y,s.sprite);p.setDepth(3001),c.sprite=p,this.projectiles.push(c),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(c)}}}export{A as CannonTower};
