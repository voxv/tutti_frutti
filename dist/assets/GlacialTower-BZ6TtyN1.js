import{A as c,t as o}from"./index-IaGGzpQf.js";class l extends c{applyUpgrade(t){this.upgrades||(this.upgrades=[]),t==="bigger_range"||t==="even_bigger_range"?(this.range+=52,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range),window.sceneRef&&window.sceneRef.refreshUpgradeUIIfVisible&&window.sceneRef.refreshUpgradeUIIfVisible(),console.debug(`[GlacialTower] Bought ${t}, new range:`,this.range)):t==="attack_speed"?(this.fireRate+=1.5,this._placedSprite&&this._placedSprite.towerFireRate!==void 0&&(this._placedSprite.towerFireRate=this.fireRate),console.debug("[GlacialTower] Bought attack_speed, new fireRate:",this.fireRate)):t==="attack_speed_2"?(this.fireRate+=2,this._placedSprite&&this._placedSprite.towerFireRate!==void 0&&(this._placedSprite.towerFireRate=this.fireRate),console.debug("[GlacialTower] Bought attack_speed_2, new fireRate:",this.fireRate)):t==="deep_freeze_1"?(this._deepFreeze1=!0,this._freezeDuration=2e3):t==="deep_freeze_2"&&(this._deepFreeze2=!0,this._freezeDuration=3e3),this.upgrades.push(t)}constructor(t={}){let i={range:120,fireRate:1,damage:1,cost:200,type:"glacial"};o&&o.glacial&&(i={...i,...o.glacial}),super({...i,...t,type:"glacial"}),this.upgrades||(this.upgrades=[]),this._freezeDuration=1e3}fire(t,i){if(i-this.lastShotTime>=1/this.fireRate){this.lastShotTime=i;const s=[];for(const e of t)if(e.isActive&&this.isInRange(e)&&(s.push(e),s.length>=this.maxBloonsPerAttack))break;for(const e of s){const r=e.type==="boss"||e.constructor?.name==="BossBloon";typeof e.freeze=="function"&&e.freeze(this._freezeDuration),!r&&this._deepFreeze1&&typeof e.takeDamage=="function"&&setTimeout(()=>{e.takeDamage(e.health)},this._freezeDuration)}if(s.length>0&&typeof window.sceneRef=="object"&&window.sceneRef){const e=window.sceneRef.add.circle(this.position.x,this.position.y,this.range*.5,16777215,.4);e.setDepth(3e3),window.sceneRef.tweens.add({targets:e,alpha:0,scale:2,duration:200,onComplete:()=>e.destroy()})}}}upgrade(){this.level++,this.range+=20,this.damage+=1,this.fireRate+=.2,this.cost+=100,this.upgrades.push({level:this.level})}static placeOnScene(t,i,s){const e=t&&t.cache&&t.cache.json&&t.cache.json.get?t.cache.json.get("tower"):null;let r=120;e&&e.glacial&&e.glacial.range&&(r=e.glacial.range);const n=new l({position:{x:i,y:s}}),f=220/2,a=t.add.image(i,s,"glacial").setDisplaySize(f*.72,100*.72).setDepth(1001).setAlpha(1).setInteractive({useHandCursor:!0});return a.setFrame(0),a.towerType="glacial",a.towerX=i,a.towerY=s,a.towerRange=r,n._placedSprite=a,n}}export{l as GlacialTower};
