import{T as l}from"./index-BAlOrAgp.js";class m extends l{constructor(n={}){super({...n,type:n.type||"projectile"}),this.projectiles=[],this._bloonEntryTimes=new Map,this.targetingPriority=n.targetingPriority||"First"}acquireTarget(n){const c=Date.now(),i=new Set;for(const e of n)e&&e.isActive&&this.isInRange(e)&&(i.add(e),this._bloonEntryTimes.has(e)||this._bloonEntryTimes.set(e,c));for(const e of this._bloonEntryTimes.keys())i.has(e)||this._bloonEntryTimes.delete(e);const g=this.targetingPriority||"First",s=Array.from(i);if(s.length===0)return this.target=null,null;let o=null;if(g==="First")o=s.reduce((e,t)=>t.progress>e.progress?t:e,s[0]);else if(g==="Last"){o=s.reduce((r,a)=>this._bloonEntryTimes.get(a)>this._bloonEntryTimes.get(r)?a:r,s[0]);const e=this._bloonEntryTimes.get(o),t=s.filter(r=>this._bloonEntryTimes.get(r)===e);t.length>1&&(o=t.reduce((r,a)=>a.progress<r.progress?a:r,t[0]))}else g==="Strong"?o=s.reduce((e,t)=>{const r=typeof t.damage=="number"?t.damage:1,a=typeof e.damage=="number"?e.damage:1;return r>a?t:e},s[0]):o=s[0];return this.target=o,o}fire(n,c){if((!this.target||!this.isInRange(this.target))&&this.acquireTarget(n),typeof window.sceneRef=="object"&&window.sceneRef){const i=window.sceneRef.add.circle(this.position.x,this.position.y,this.range*.5,16746496,.4);i.setDepth(3e3),window.sceneRef.tweens.add({targets:i,alpha:0,scale:2,duration:200,onComplete:()=>i.destroy()})}}update(n,c){let i=Date.now()/1e3;this.fire(c,i)}}export{m as ProjectileTower};
