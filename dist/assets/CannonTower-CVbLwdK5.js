import{ProjectileTower as g}from"./ProjectileTower-B8790ZSB.js";import{t as h}from"./index-GPUS-3tt.js";import{p as f}from"./projectiles-CDq3D0-e.js";import{B as u}from"./BoulderProjectile-DaDxGvld.js";import"./Projectile-BlnVoN5p.js";class d extends g{constructor(e={}){let t={range:150,fireRate:1.5,damage:3,cost:350,type:"cannon",homing:!1};h&&h.cannon&&(t={...t,...h.cannon}),super({...t,...e,type:"cannon"}),this.projectileTexture="boulder",this.homing=e.homing!==void 0?e.homing:t.homing}applyUpgrade(e){e==="bigger_range"||e==="even_bigger_range"?(this.range+=52,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range)):e==="world_wide_range"?(this.range+=200,this._placedSprite&&this._placedSprite.towerRange!==void 0&&(this._placedSprite.towerRange=this.range)):e==="rapid_barrage"&&(this.fireRate=4,this._placedSprite&&this._placedSprite.towerFireRate!==void 0&&(this._placedSprite.towerFireRate=this.fireRate)),this.upgrades.push(e)}update(e,t){let a=Date.now()/1e3;!(t&&t.some(s=>s&&s.isActive&&this.isInRange(s)))&&this._placedSprite&&(this._placedSprite.anims&&this._placedSprite.anims.isPlaying&&this._placedSprite.anims.stop(),typeof this._placedSprite.setFrame=="function"&&this._placedSprite.setFrame(0)),this.fire(t,a)}static placeOnScene(e,t,a){const i=e&&e.cache&&e.cache.json&&e.cache.json.get?e.cache.json.get("tower"):null;let s=150;i&&i.cannon&&i.cannon.range&&(s=i.cannon.range);const n=new d({position:{x:t,y:a}}),o=220/2,r=e.add.sprite(t,a,"cannon_placed").setDisplaySize(o*.55,100*.55).setDepth(8500).setAlpha(1).setInteractive({useHandCursor:!0});return r.towerType="cannon",r.towerX=t,r.towerY=a,r.towerRange=s,n._placedSprite=r,n}fire(e,t){if(this.acquireTarget(e),this.target&&t-this.lastShotTime>=1/this.fireRate){this.lastShotTime=t,this._placedSprite&&this._placedSprite.anims&&this._placedSprite.anims.play("cannon_placed_anim",!0);const a=f.boulder||{speed:400,hitRadius:36,sprite:"boulder"},i={x:this.position.x+16,y:this.position.y-8};if(!this.target||!this.target.position)return;const s=this.target.position.x-i.x,n=this.target.position.y-i.y,o=Math.sqrt(s*s+n*n),l={x:s/o,y:n/o};let r=1;this.upgrades&&this.upgrades.includes("pop_three_fruits")?r=3:this.upgrades&&this.upgrades.includes("pop_two_fruits")&&(r=2);const c=new u({position:{...i},direction:l,speed:a.speed,damage:this.damage,texture:this.projectileTexture,target:this.target,hitRadius:a.hitRadius,homing:this.homing,maxHits:r,showExplosion:!1}),p=window.sceneRef.add.sprite(i.x,i.y,a.sprite);p.setDisplaySize(24,24),p.setScale(.7),p.setDepth(3001),c.sprite=p,this.projectiles.push(c),window.sceneRef&&window.sceneRef.gameLogic&&Array.isArray(window.sceneRef.gameLogic.projectiles)&&window.sceneRef.gameLogic.projectiles.push(c)}}}export{d as CannonTower};
